language: python
sudo: false
cache: pip
services:
  - docker
senv:
  global:
    - LD_PRELOAD=/lib/x86_64-linux-gnu/libSegFault.so
    - SEGFAULT_SIGNALS=all
matrix:
  include:
    - python: '3.8'
      env:
        - TOXENV=check
        - SCRIPT=tox
    - python: '3.8'
      env:
        - TOXENV=docs
        - SCRIPT=tox
    - python: '3.6'
      env:
        - TOXENV=3.6-nocov
        - SCRIPT=tox
    - python: '3.7'
      env:
        - TOXENV=3.7-cover,report,coveralls,codecov
        - SCRIPT=tox
    - python: '3.7'
      env:
        - TOXENV=3.7-nocov
        - SCRIPT=tox
    - python: '3.8'
      env:
        - TOXENV=3.8-nocov
        - SCRIPT=tox
    - python: '3.8'
      env:
        - SCRIPT=docker
before_install:
  - python --version
  - uname -a
  - lsb_release -a
install:
  - pip install tox twine
  - virtualenv --version
  - easy_install --version
  - pip --version
  - tox --version
script:
  - |
    case $SCRIPT in
      tox)
        tox -v
        ;;

      docker)
        docker build . -f docker/Dockerfile.test -t zsl-test
        docker run --rm zsl-test --version
        ;;
    esac
after_failure:
  - more .tox/log/* | cat
  - more .tox/*/log/* | cat
notifications:
  email:
    on_success: never
    on_failure: always
deploy:
  provider: pypi
  user: atteq
  edge: true
  password: "k8LDjKjVNWaQCfUQECAj25g1aHfkfJRiAlJ/1wNPYK9YrpRwNYMdYEmGiRnnKstvxwhD2aSHSKKdpFLLl/cfvITAUqCgqre/OpWIjWWBVOVOgELTtz+/irPoCyZ/84I0rqggvgVOgq2rHqKUviKaUes2YYheOf9HbSK655pO2fq6E4wLX6fHmTaudwRwitko5/g93eIgFPRopVRpPpSrw+7MGyxbY2SLrWVUBeu4CTVlRVBQhVefArp8dVn47a6MG65tAM8oiE5JAEdc+Qqf6r/SpVvtMPs/dy8z/rmvRdJ0ChH/YJdosFxnnJYK1pWEymbpno3qQXgHOw3OI3oZGqOs/Q00H2EAUE/ZYwnnKQYBkRp1aImF6ehEJ1s+iPlaFMNSj8lPby4ehj29lfIKgOiBCSX3zt+9gSjL8OXWMgMUMH9/LMDMOFZTkkAMx90MT1uHYCcwGjjOPztaj6TJpzhS1764GkScBmz2qHqpEJqZIEin6wT/Vx9E8a+PRVt0wCfOVBZ6wEp5S3yUTnGburfJu0Ne7avljF61LG+gUvq+jFGjmHks/jcBs7EoEH/+35eyO50K93JjaRdaFWqh4JUvFPP3CE1WhGIxRM5T7hND3ab58LpYhsoA0WuCM914gpuuo4A8Pgrnglq3I8zReDMNbR6fgOy2puVyo2w5rug="
  distributions: sdist bdist_wheel
  on:
    tags: true
    condition: $TOXENV = check
    repo: AtteqCom/zsl
